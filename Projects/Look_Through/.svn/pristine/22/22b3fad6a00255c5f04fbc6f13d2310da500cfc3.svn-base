#include "Audio.h"
#include "Game.h"


void Audio::handleEvent(const Event& theEvent)
{
	if (theEvent.getType() == (EventType)GameEventType::VOLUME_CHANGE_EVENT)
	{
		setVolume(((VolumeChangeEvent&)theEvent).getNewVolume());
		Game::getInstance()->setGameVolume(((VolumeChangeEvent&)theEvent).getNewVolume());
	}
}


void Audio::init(const std::string& fileName, bool looping, float volume, float secondsProgress)
{
	loadFile(fileName);
	setLooping(looping);
	setVolume(volume);
	setSecondsProgress(secondsProgress);

	EventSystem::getInstance()->addListener((EventType)GameEventType::VOLUME_CHANGE_EVENT, this);
}


void Audio::cleanup()
{
	delete mpSoundSource;
	EventSystem::getInstance()->removeListenerFromAllEvents(this);
}

#include "Animation.h"

Animation::Animation(AnimationPrototype* pProto, float timePerFrame, bool looping)
{
	mpPrototype = pProto;
	mCurrentSprite = 0;
	mLooping = looping;
	mTimePerFrame = timePerFrame;
	mTimeUntilNextFrame = 0;
}

void Animation::setTimePerFrame(float newTimePerFrame)
{
	mTimePerFrame = newTimePerFrame;
	if (mTimeUntilNextFrame > mTimePerFrame)
	{
		mTimeUntilNextFrame = mTimePerFrame;
	}
}

const Sprite& Animation::getCurrentSprite() const
{
	return mpPrototype->getSprite(mCurrentSprite);
}

void Animation::update(double dt)
{
	 // non-looping animation at the end?
	if (!mLooping && mCurrentSprite == mpPrototype->getNumSprites() - 1)
	{
		return;
	}

	mTimeUntilNextFrame -= dt;

	if (mTimeUntilNextFrame <= 0)
	{
		mCurrentSprite++;
		mTimeUntilNextFrame = mTimePerFrame + mTimeUntilNextFrame;
	}

	if (mCurrentSprite >= (int)mpPrototype->getNumSprites())
	{
		mCurrentSprite = 0;
	}
}
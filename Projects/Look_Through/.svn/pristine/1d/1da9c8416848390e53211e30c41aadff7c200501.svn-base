#include "StartScreen.h"
#include "Font.h"
#include "Color.h"
#include "Game.h"
#include "GraphicsSystem.h"
#include "GraphicsBuffer.h"
#include "GraphicsBufferManager.h"

StartScreen::StartScreen()
{
	Game* pGame = Game::getGameInstance();

	const std::string FONT_FILE = "cour.ttf";
	const int FONT_SIZE = 32;
	Font font = Font(FONT_FILE, FONT_SIZE);
	Color black = Color(0, 0, 0, 255);
	Color white = Color(255, 255, 255, 255);

	const std::string START_SCREEN_KEY = "startScreen";
	const std::string START_SCREEN_TITLE = "SNAKE by Merle Roji";
	const std::string START_SCREEN_INSTRUCTIONS = "Press the Enter Key to Begin";
	const std::string TEXT_CENTER_ALIGN = "center";

	const Vector2D TITLE_POS = Vector2D(pGame->CENTER_LOCATION.getX(), pGame->CENTER_LOCATION.getY() - 96);

	pGame->getGraphicsBufferManager()->createGraphicsBuffer(START_SCREEN_KEY, pGame->DISP_WIDTH, pGame->DISP_HEIGHT);
	pGame->getGraphicsSystem()->setColor(pGame->getGraphicsBufferManager()->getGraphicsBuffer(START_SCREEN_KEY), &black);
	pGame->getGraphicsSystem()->writeText(pGame->getGraphicsBufferManager()->getGraphicsBuffer(START_SCREEN_KEY),
		TITLE_POS, &font, white, START_SCREEN_TITLE, ALLEGRO_ALIGN_CENTER);
	pGame->getGraphicsSystem()->writeText(pGame->getGraphicsBufferManager()->getGraphicsBuffer(START_SCREEN_KEY),
		pGame->CENTER_LOCATION, &font, white, START_SCREEN_INSTRUCTIONS, ALLEGRO_ALIGN_CENTER);

	this->mpScreenSprite = new Sprite(pGame->ORIGIN_LOCATION,
		pGame->getGraphicsBufferManager()->getGraphicsBuffer(START_SCREEN_KEY),
		pGame->getGraphicsBufferManager()->getGraphicsBuffer(START_SCREEN_KEY)->getBitmapWidth(),
		pGame->getGraphicsBufferManager()->getGraphicsBuffer(START_SCREEN_KEY)->getBitmapHeight());
}

StartScreen::~StartScreen()
{
	delete mpScreenSprite;
}

void StartScreen::drawStartScreen()
{
	Game::getGameInstance()->getGraphicsSystem()->draw(Game::getGameInstance()->ORIGIN_LOCATION, *mpScreenSprite);
}
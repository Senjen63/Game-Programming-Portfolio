#include "UnitManager.h"

UnitManager::UnitManager()
{

}

UnitManager::~UnitManager()
{

}

void UnitManager::setAnimation()
{
	mUnits[mUnits.size() - 1].setAnimation();
}

void UnitManager::addUnit(Unit unit)
{
	mUnits.push_back(unit);
}

void UnitManager::removeUnit(Vector2D location)
{
	for (int i = 0; i < mUnits.size(); i++)
	{
		float xDiff = abs(mUnits[i].getLocationX() - location.getX());
		float yDiff = abs(mUnits[i].getLocationY() - location.getY());

		float xArea = mUnits[i].currentAnimation().getCurrentSprite().getHeight() / 2;
		float yArea = mUnits[i].currentAnimation().getCurrentSprite().getWidth() / 2;

		if (xDiff <= xArea && yDiff <= yArea)
		{
			mUnits.erase(mUnits.begin() + i);
		}
	}
}

Unit UnitManager::getRecentUnit()
{
	return mUnits[mUnits.size() - 1];
}

Unit UnitManager::getUnit(Vector2D location)
{
	for (int i = 0; i < mUnits.size(); i++)
	{
		Vector2D unitLoc(mUnits[i].getLocationX(), mUnits[i].getLocationY());
		if (unitLoc == location)
		{
			return mUnits.at(i);
		}
	}
}

void UnitManager::removeAll()
{
	mUnits.clear();
}

void UnitManager::updateAll(double dt)
{
	for(int i = 0; i < mUnits.size(); i++)
	{
		mUnits[i].update(dt);
	}
}

void UnitManager::drawAll(int scale)
{
	for (int i = 0; i < mUnits.size(); i++)
	{
		Vector2D sourceLoc(mUnits[i].currentAnimation().getCurrentSprite().getLoc().getX(), mUnits[i].currentAnimation().getCurrentSprite().getLoc().getY());

		Vector2D sourceDim(mUnits[i].currentAnimation().getCurrentSprite().getWidth(), mUnits[i].currentAnimation().getCurrentSprite().getHeight());

		Vector2D desLoc(mUnits[i].getLocationX(), mUnits[i].getLocationY());

		Vector2D desDim(mUnits[i].currentAnimation().getCurrentSprite().getWidth() * scale, mUnits[i].currentAnimation().getCurrentSprite().getHeight() * scale);

		mUnits[i].draw(sourceLoc, sourceDim, desLoc, desDim, 1);
	}
}

bool UnitManager::isEmpty()
{
	return mUnits.empty();
}
#pragma once

#include <string>
#include <vector>

#include <EventListener.h>
#include <Vector2D.h>

#include "Color.h"
#include "HUD.h"

enum class UnitType;
enum class PlayerAction;

class GraphicsBufferManager;
class InputTranslator;
class GraphicsSystem;
class GraphicsBuffer;
class LevelManager;
class EventSystem;
class InputSystem;
class UnitManager;
class Animation;
class Sprite;
class Level;
class Font;
class Unit;

using namespace std;

class Game : public EventListener
{
public:

	static Game* getInstance();
	static void createInstance();
	static void destroyInstance();	

	GraphicsBufferManager* getGraphicsBufferManager();
	UnitManager* getUnitManager();

	GraphicsSystem* getGraphicsSystem();	
	EventSystem* getEventSystem();
	InputSystem* getInputSysyem();

	void init(int width, int height);
	void cleanup();

	void doLoop();
	void handleEvent(const Event& theEvent);

private:

	Game() {};
	~Game();	

	void endGame();
	void restartGame();
	void parsePlayerAction(PlayerAction action);	
	void loadFile();
	
	static Game* mpsGame;

	GraphicsSystem* mpGraphicsSystem = nullptr;	
	EventSystem* mpEventSystem = nullptr;
	InputSystem* mpInputSystem = nullptr;

	InputTranslator* mpTranslator = nullptr;

	Animation* mpWallAnim = nullptr;
	Animation* mpSnakeAnim = nullptr;
	Animation* mpFoodAnim = nullptr;
	Animation* mpPointsAmim = nullptr;
	Animation* mpSpeedAnim = nullptr;
	Animation* mpSlowAnim = nullptr;

	LevelManager* mpLevelManager = nullptr;
	Level* mpCurrentLevel = nullptr;

	GraphicsBufferManager* mpGraphicsBufferManager = nullptr;
	UnitManager* mpUnitManager = nullptr;

	Font* mpHUDFont = nullptr;	
	HUD* mpHUD = nullptr;

	int mDispWidth = 0;			// Units in pixels
	int mDispHeight = 0;

	bool mKeepGoing = true;	
	bool mGameWon = false;
	bool mGameOver = false;
	bool mGameActive = false;

	int mLevelsCompleted = 0;
	int mTotalNumLevels = 3;
	int mScore = 0;

	const int TARGET_FRAME_RATE = 60;
	const int ONE_SECOND_IN_MS = 1000;
	const double FRAME_INTERVAL_IN_MS = (1.0 / (double)TARGET_FRAME_RATE) * ONE_SECOND_IN_MS;
	//const double ANIM_SWAP_DELAY_IN_MS = 100;
	//const double ANIM_PAUSE_DELAY_IN_MS = 100;

	int mSpriteWidth = 0;		// Units in pixels
	int mSpriteHeight = 0;
	int mSpritesPerRow = 0;	
	const int ROWS_PER_ANIM = 1;

	int mWallRow = 0;
	int mSnakeRow = 0;
	int mFoodRow = 0;
	int mPointsRow = 0;
	int mSpeedRow = 0;
	int mSlowRow = 0;

	//string mAssetPath = "\\GameData\\";
	string mGameDataFilename = "GameData.txt";
	string mStartScreenFilename = "";
	string mWinScreenFilename = "";
	string mLoseScreenFilename = "";
	string mSpriteSheetFilename = "";
	string m1stLevelFilename = "";
	string m2ndLevelFilename = "";
	string m3rdLevelFilename = "";

	const string ASSET_PATH = "..\\..\\common\\assets\\";
	const string BACKGROUND_FILENAME = "woods.png";
	const string DEAN_FILENAME = "dean_sprites.png";
	const string SMURF_FILENAME = "smurf_sprites.png";
	const string FONT_FILENAME = "cour.ttf";
	const int HUD_FONT_SIZE = 24;
	//const string SAMPLE_FILENAME = "clapping.wav";
	//const double SLEEP_TIME = 5.0;

	const Vector2D ORIGIN = Vector2D(0, 0);		
};
	


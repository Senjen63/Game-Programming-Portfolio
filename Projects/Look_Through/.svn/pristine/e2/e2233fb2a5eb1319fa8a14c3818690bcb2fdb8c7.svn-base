#pragma once

#include <Vector2D.h>
#include <unordered_map>

#include "GraphicsSystem.h"
#include "Animation.h"
#include "UnitParameters.h"
#include "Component.h"
#include "CollisionLayer.h"

class Component;

class Unit : public Trackable
{
	friend class UnitManager;
	friend class Component;

	Vector2D mPosition;
	
	std::unordered_map<std::string, Animation> mAnimations;

	std::string mCurrentAnimationName;
	Animation* mpCurrentAnimation;

	std::unordered_map<std::string, Component*> mComponents;

	CollisionLayer mColLayer;

	Unit(const UnitParameters params);
	~Unit();

public:
	Vector2D getPos() { return mPosition; }
	void setPos(Vector2D pos) { mPosition = pos; }

	float getX() { return mPosition.getX(); }
	void setX(float x) { mPosition.setX(x); }

	float getY() { return mPosition.getY(); }
	void setY(float y) { mPosition.setY(y); }

	void addAnimation(std::string animName, Animation& newAnim);
	Animation& getAnimation(std::string animName);

	Animation* getCurrentAnimation() { return mpCurrentAnimation; }
	std::string getCurrentAnimationName() { return mCurrentAnimationName; }
	void setCurrentAnimation(std::string animName);

	void addComponent(std::string compName, Component& comp);
	void removeComponent(std::string compName);
	Component& getComponent(std::string compName);

	CollisionLayer getCollisionLayer() { return mColLayer; }
	void setCollisionLayer(CollisionLayer colLayer) { mColLayer = colLayer; }

	void doUpdate(float dt); // Delta time in milliseconds
	void doDraw(GraphicsSystem* gSys);

protected:
	virtual void update(float dt) {};
	virtual void draw(GraphicsSystem* gSys) {};
};


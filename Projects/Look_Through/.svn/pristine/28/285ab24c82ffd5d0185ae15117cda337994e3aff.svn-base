#include "Unit.h"
#include "Game.h"

Unit::Unit()
{
	mpSmurfAnim = nullptr;
	mpDeanAnim = nullptr;
	mX = 0;
	mY = 0;
	mCurrentAnim = 0;
	enabled = true;
}

Unit::Unit(Animation* pSmurf, Animation* pDean, int x, int y)
{
	mpSmurfAnim = pSmurf;
	mpDeanAnim = pDean;
	mX = x;
	mY = y;
	mCurrentAnim = 0;
	enabled = true;
}

Unit::Unit(string smurfKey, string deanKey, Vector2D pos)
{
	mpSmurfAnim = new Animation(Game::getGame()->getBufferManager()->getBuffer(smurfKey), true);
	mpDeanAnim = new Animation(Game::getGame()->getBufferManager()->getBuffer(deanKey), true);
	mX = pos.getX();
	mY = pos.getY();
	mCurrentAnim = 0;
	enabled = true;
}

Unit::Unit(string wallKey, Vector2D pos)
{
	mpSmurfAnim = new Animation(Game::getGame()->getBufferManager()->getBuffer(wallKey));
	mpDeanAnim = nullptr;
	mX = pos.getX();
	mY = pos.getY();
	mCurrentAnim = 0;
	enabled = true;
}

Unit::Unit(string foodKey, Vector2D pos, int width, int height)
{
	mpSmurfAnim = new Animation(Game::getGame()->getBufferManager()->getBuffer(foodKey), width, height);
	mpDeanAnim = nullptr;
	mX = pos.getX();
	mY = pos.getY();
	mCurrentAnim = 0;
	enabled = true;
}

Unit::~Unit()
{
	delete mpSmurfAnim;
	delete mpDeanAnim;
	mpSmurfAnim = nullptr;
	mpDeanAnim = nullptr;
	mX = 0;
	mY = 0;
	mCurrentAnim = 0;
	enabled = true;
}

float Unit::getTime()
{
	return mpSmurfAnim->getTime();
}

void Unit::update(double dt)
{
	if (enabled)
	{
		if(mpSmurfAnim != nullptr)
			mpSmurfAnim->update(dt);
		if(mpDeanAnim != nullptr)
			mpDeanAnim->update(dt);
	}
}

void Unit::draw(GraphicsSystem* display)
{
	if (mCurrentAnim == 0)
	{
		display->draw(mpSmurfAnim->getCurrentSprite()->getX(), mpSmurfAnim->getCurrentSprite()->getY(), mpSmurfAnim->getCurrentSprite(), 
			mX + (WALL_WIDTH / 2), mY + (WALL_HEIGHT / 2));
	}	
	else
	{
		display->draw(mpDeanAnim->getCurrentSprite()->getX(), mpDeanAnim->getCurrentSprite()->getY(), mpDeanAnim->getCurrentSprite(),
			mX + (WALL_WIDTH / 2), mY + (WALL_HEIGHT / 2));
	}
}

void Unit::setAnimation()
{
	if (mCurrentAnim == 0)
		mCurrentAnim = 1;
	else
		mCurrentAnim = 0;
}

void Unit::changeTiming(float timerChange)
{
	mpSmurfAnim->changeTimer(timerChange);
	mpDeanAnim->changeTimer(timerChange);
}

void Unit::toggleEnable()
{
	enabled = !enabled;
}

Vector2D Unit::getPos()
{
	Vector2D pos = Vector2D(mX, mY);
	return pos;
}

void Unit::setPos(Vector2D pos)
{
	mX = pos.getX();
	mY = pos.getY();
}
//Evan Norzow, Nicolas Delbue, and Brandon Perry
#include "GraphicsSystem.h"

GraphicsSystem::GraphicsSystem()
{
}

GraphicsSystem::GraphicsSystem(int width, int height)
{
	mWidth = width;
	mHeight = height;
}

GraphicsSystem::~GraphicsSystem()
{
	cleanup();
}

int GraphicsSystem::getWidth()
{
	return mWidth;
}

int GraphicsSystem::getHeight()
{
	return mHeight;
}

bool GraphicsSystem::init()
{
	if (SDL_Init(SDL_INIT_EVERYTHING) != 0)
	{
		std::cout << "Issues loading SDL." << std::endl;
		system("pause");
		return false;
	}

	if (TTF_Init() != 0)
	{
		std::cout << "Issues loading fonts." << std::endl;
		system("pause");
		return false;
	}

	if (IMG_Init(IMG_INIT_PNG) == 0)
	{
		std::cout << "Issues loading IMGs." << std::endl;
		system("pause");
		return false;
	}

	string title = "Main Display";

	mpWindow = SDL_CreateWindow
	(
		title.c_str(),
		SDL_WINDOWPOS_CENTERED,
		SDL_WINDOWPOS_CENTERED,
		mWidth, mHeight,
		0
	);

	if (mpWindow == nullptr)
	{
		std::cout << "Issues with Window." << std::endl;
		system("pause");
		return false;
	}

	mpRenderer = SDL_CreateRenderer(mpWindow, -1, 0);

	if (mpRenderer == nullptr)
	{
		std::cout << "Issues with Renderer." << std::endl;
		system("pause");
		return false;
	}

	
	//mpWindow = new Window("Main", mWidth, mHeight);

	return true;
}

void GraphicsSystem::cleanup()
{
	SDL_Quit();
	SDL_DestroyRenderer(mpRenderer);
	SDL_DestroyWindow(mpWindow);
	IMG_Quit();
	TTF_Quit();
	
}

void GraphicsSystem::flip()
{
	SDL_RenderPresent(mpRenderer);
}

void GraphicsSystem::clear()
{
	SDL_RenderClear(mpRenderer);
}

void GraphicsSystem::draw(Sprite sprite, int hori, int vert, float horiScale, float vertScale)
{
	Vector2D position = sprite.getSourcePosition();
	Vector2D heightAndWidth = sprite.getHeightAndWidth();

	SDL_Rect Srcr;
	SDL_Rect Destr;

	Srcr.x = position.getX();
	Srcr.y = position.getY();
	Srcr.w = heightAndWidth.getX();
	Srcr.h = heightAndWidth.getY();

	Destr.x = hori;
	Destr.y = vert;
	Destr.w = heightAndWidth.getX() * horiScale;
	Destr.h = heightAndWidth.getY() * vertScale;

	SDL_RenderCopy(mpRenderer, sprite.getSpriteBuff().mpBitmap, &Srcr, &Destr);
}

void GraphicsSystem::draw(GraphicsBuffer* pBackBuff, int hori, int vert, float horiScale, float vertScale)
{
	SDL_Rect Destr;

	Destr.x = hori;
	Destr.y = vert;
	Destr.w = pBackBuff->getWidth() * horiScale;
	Destr.h = pBackBuff->getHeight() * vertScale;

	SDL_RenderCopy(mpRenderer, pBackBuff->mpBitmap, NULL, &Destr);
}

void GraphicsSystem::displayMessage(int hori, int vert, string message, Color color, Font* font)
{
	TTF_Font* textFont = font->mpFont;
	SDL_Color textColor = { color.getR(), color.getG(), color.getB(), color.getA()};
	SDL_Surface* textSurface = TTF_RenderText_Solid(textFont, message.c_str(), textColor);
	SDL_Texture* textTexture = SDL_CreateTextureFromSurface(mpRenderer, textSurface);

	SDL_FreeSurface(textSurface);
	textSurface = nullptr;

	SDL_Rect textRect;
	textRect.x = hori;
	textRect.y = vert;
	SDL_QueryTexture(textTexture, NULL, NULL, &textRect.w, &textRect.h);
	SDL_RenderCopy(mpRenderer, textTexture, NULL, &textRect);

	SDL_DestroyTexture(textTexture);
	textTexture = nullptr;
}
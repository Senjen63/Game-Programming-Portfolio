#include "Sprite.h"
#include <cassert>

using namespace std;

std::vector<Sprite> Sprite::slice(GraphicsBuffer* pBuffer, int spriteWidth, int spriteHeight, int numSprites, int sheetWidth, int sheetHeight, Vector2D sheetStart)
{
    assert(pBuffer);

    if (sheetWidth == -1)
        sheetWidth = pBuffer->getWidth();
    if (sheetHeight == -1)
        sheetHeight = pBuffer->getHeight();
    if (numSprites == -1)
        numSprites = (sheetHeight / spriteHeight) * (sheetWidth / spriteWidth);

    // Find numSprites to preallocate memory 
    vector<Sprite> sprites = vector<Sprite>();
    sprites.reserve(numSprites);

    for (int y = (int)sheetStart.getY(); y < sheetStart.getY() + sheetHeight; y += spriteHeight)
    {
        for (int x = (int)sheetStart.getX(); x < sheetStart.getX() + sheetWidth; x += spriteWidth)
        {
            sprites.push_back(Sprite(pBuffer, Vector2D(x, y), spriteWidth, spriteHeight));

            if ((int)sprites.size() >= numSprites)
            {
                break; break;
            }
        }
    }

    return sprites;
}

Sprite::Sprite(GraphicsBuffer* pBuffer, const Vector2D& loc, int width, int height) :
    mpBuffer(pBuffer),
    mLoc(loc),
    mWidth(width),
    mHeight(height)
{}

Sprite::Sprite(GraphicsBuffer* pBuffer) :
    Sprite(pBuffer, Vector2D(), pBuffer->getWidth(), pBuffer->getHeight()) {}

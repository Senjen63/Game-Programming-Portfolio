#include "InputSystem.h"

InputSystem::InputSystem()
{
	mpKeyboardState = nullptr;
	mpMouseState = nullptr;

	mIsActive = false;
}


InputSystem::~InputSystem()
{
	delete mpKeyboardState;
	mpKeyboardState = nullptr;
	
	delete mpMouseState;
	mpMouseState = nullptr;

	if (mIsActive)
	{
		deinit();
	}
}


bool InputSystem::init()
{
	assert(al_is_system_installed()); // Don't proceed if allegro isn't initialized.

	if (mIsActive)
	{
		// Mark as successful if we're already initialized.
		return true;
	}
	else
	{
		if (!al_install_keyboard())
		{
			cout << "Failed to initialize keyboard\n";
			return false;
		}

		if (!al_install_mouse())
		{
			cout << "Failed to initialize mouse\n";
			return false;
		}

		mpKeyboardState = new ALLEGRO_KEYBOARD_STATE;
		mpMouseState = new ALLEGRO_MOUSE_STATE;

		mIsActive = true;
		return true;
	}
}


void InputSystem::deinit()
{
	al_uninstall_keyboard();
	al_uninstall_mouse();

	mIsActive = false;
}


bool InputSystem::getKeyState(int keyCode)
{
	assert(mIsActive);
	return al_key_down(mpKeyboardState, keyCode);
}


bool InputSystem::getMouseButtonState(int mouseCode)
{
	assert(mIsActive);
	return al_mouse_button_down(mpMouseState, mouseCode);
}


Vector2D InputSystem::getMousePosition()
{
	assert(mIsActive);
	return Vector2D(mpMouseState->x, mpMouseState->y);
}


void InputSystem::update()
{
	assert(mIsActive);
	al_get_keyboard_state(mpKeyboardState);
	al_get_mouse_state(mpMouseState);
}

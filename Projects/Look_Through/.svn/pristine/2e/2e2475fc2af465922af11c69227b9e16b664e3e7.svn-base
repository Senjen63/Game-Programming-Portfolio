#pragma once

#include <PerformanceTracker.h>
#include <vector>

#include "GraphicsSystem.h"
#include "InputSystem.h"
#include "Animation.h"
#include "Unit.h"
#include "Keycode.h"
#include "Mousecode.h"
#include "Conversion.h"
#include "UnitManager.h"
#include "GraphicsBufferManager.h"


class Game : public Trackable
{
	const std::string PERFORMANCE_TRACKER_STRING = "loop";

	static Game* mpGame;

	Vector2D mWindowSize;

	float mTargetTimeInMilliseconds;
	float mTargetFramesPerSecond;

	GraphicsSystem* mpGraphicsSystem;
	UnitManager* mpUnitManager;
	GraphicsBufferManager* mpGraphicsBufferManager;
	InputSystem* mpInputSystem;

	void update(float dt);
	void render();

	Game(int targetFramerate) { setTargetFramesPerSecond(targetFramerate); }
	~Game() { cleanupInstance(); mpGame = nullptr; }

public:

	static Game* getInstance();
	static Game* createInstance(int targetFramerate = 60);
	static void destroyInstance() { delete mpGame; mpGame = nullptr; }
	void initInstance(Vector2D windowSize = Vector2D(800, 600));
	void cleanupInstance();

	UnitManager* getUnitManager() { return mpUnitManager; }
	GraphicsBufferManager* getGraphicsBufferManager() { return mpGraphicsBufferManager; }

	float getTargetFramesPerSecond() { return mTargetFramesPerSecond;  }
	void setTargetFramesPerSecond(float fps) { mTargetTimeInMilliseconds = 1000.0f / fps; mTargetFramesPerSecond = fps; }

	float getTargetTimeInMilliseconds() { return mTargetTimeInMilliseconds; }
	float setTargetTimeInMilliseconds(float ms) { mTargetFramesPerSecond = ms * 1000.0; mTargetTimeInMilliseconds = ms; }

	void doLoop();
};
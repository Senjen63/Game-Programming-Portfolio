#include "InputSystem.h"

InputSystem::InputSystem()
{
	init();
}

InputSystem::~InputSystem()
{
	cleanup();
}

void InputSystem::update()
{
	// gets mouse and keyboard state after every update
	al_get_mouse_state(&mMouseState);
	al_get_keyboard_state(&mState);
}

void InputSystem::init()
{
	// install keyboard
	al_install_keyboard();
	assert(al_install_keyboard());

	// install mouse
	al_install_mouse();
	assert(al_install_mouse());

	mpQueue = al_create_event_queue();
	al_register_event_source(mpQueue, al_get_keyboard_event_source());

	mpEventSystem = EventSystem::getInstance();
}

void InputSystem::cleanup()
{
	// uninstall keyboard and mouse
	al_uninstall_keyboard();
	al_uninstall_mouse();

	mpEventSystem->cleanup();
}

bool InputSystem::getKeyState(MyKeyCode key)
{
	// return true if given key is pressed
	return al_key_down(&mState, (int)key);
}

Vector2D InputSystem::getMouseState()
{
	// return the position of the mouse
	return Vector2D(mMouseState.x, mMouseState.y);
}

void InputSystem::getKeyEvent()
{
	while (!al_event_queue_is_empty(mpQueue))
	{
		ALLEGRO_EVENT theEvent;
		al_get_next_event(mpQueue, &theEvent);

		if (theEvent.type == ALLEGRO_EVENT_KEY_DOWN)
		{
			mpEventSystem->fireEvent(InputEvent((int)theEvent.keyboard.keycode));
		}
	}
}

bool InputSystem::isMouseDown(MyMouseCode mouse)
{
	// return true if the given mouse key is down
	return al_mouse_button_down(&mMouseState, (int)mouse);
}
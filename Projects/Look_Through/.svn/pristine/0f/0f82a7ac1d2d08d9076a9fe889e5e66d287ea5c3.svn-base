#include "Animation.h"

Animation::Animation()
{
	mpSprites = nullptr;
	mTimer = 0;
	mCurrentTime = 0;
	mCurrentSprite = 0;
	mNumSprites = 0;
	mShouldLoop = false;
}

Animation::Animation(GraphicsBuffer* pBuffer, bool loop)
{
	mpSprites = new Sprite[NUM_FRAMES];
	int localIndex = 0;

	for (int i = 0; i < 4; i++)
	{
		for (int j = 0; j < 4; j++)
		{
			mpSprites[localIndex] = Sprite(pBuffer, i * 60, j * 60, 60, 60);
			localIndex++;
		}
	}

	mTimer = 0.001;
	mCurrentTime = 0;
	mCurrentSprite = 0;
	mNumSprites = NUM_FRAMES;
	mShouldLoop = loop;
}
Animation::Animation(GraphicsBuffer* pBuffer)
{
	mpSprites = new Sprite[NUM_FRAMES];
	int localIndex = 0;

	for (int i = 0; i < 4; i++)
	{
		for (int j = 0; j < 4; j++)
		{
			mpSprites[localIndex] = Sprite(pBuffer, i * 50, j * 50, 50, 50);
			localIndex++;
		}
	}

	mTimer = 0.001;
	mCurrentTime = 0;
	mCurrentSprite = 0;
	mNumSprites = NUM_FRAMES;
	mShouldLoop = true;
}

Animation::Animation(GraphicsBuffer* pBuffer, int width, int height)
{
	mpSprites = new Sprite[width * height];
	int localIndex = 0;

	for (int i = 0; i < width; i++)
	{
		for (int j = 0; j < height; j++)
		{
			mpSprites[localIndex] = Sprite(pBuffer, i * 50, j * 50, 50, 50);
			localIndex++;
		}
	}

	mTimer = 0.001;
	mCurrentTime = 0;
	mCurrentSprite = 0;
	mNumSprites = width * height;
	mShouldLoop = true;
}

Animation::~Animation()
{
	delete[] mpSprites;

	mpSprites = nullptr;
	mTimer = 0;
	mCurrentTime = 0;
	mCurrentSprite = 0;
	mNumSprites = 0;
	mShouldLoop = false;
}

void Animation::update(double dt)
{
	if (dt > mTimer)
	{
		if (mCurrentSprite < mNumSprites - 1)
			mCurrentSprite++;
		else if (mCurrentSprite == mNumSprites - 1)
			if (mShouldLoop)
				mCurrentSprite = 0;
	}
}

void Animation::changeTimer(float timerChange)
{
	mTimer += timerChange;

	if (mTimer <= 0)
		mTimer = 0.001;

}
#pragma once

#include <PerformanceTracker.h>
#include <MemoryTracker.h>
#include <Trackable.h>
#include <Timer.h>

#include <string>
#include <fstream>
#include <iostream>
#include <time.h>

#include "EventSystem.h"
#include "EventListener.h"
#include "GraphicsSystem.h"
#include "InputSystem.h"
#include "Animation.h"
#include "Unit.h"
#include "GraphicsBufferManager.h"
#include "UnitManager.h"
#include "Snake.h"
#include "Square.h"
#include "Level.h"
#include "LevelManager.h"
#include "PowerUp.h"
#include "GameEvent.h"
#include "InputEvent.h"
#include "HUD.h"

#include <stdlib.h>

using namespace std;

class Game : public EventListener
{
public:
	Game();
	~Game();

	static Game* getInstance();

	void init();
	void cleanup();
	void doLoop();
	virtual void handleEvent(const Event& event);

private:
	static Game* mpsGame;

	bool restart = false;
	bool keepGoing = true;
	bool nextLevel = false;
	bool level = false;
	bool mainMenu = true;
	bool dead = false;
	bool transition = false;
	bool win = false;
	int points = 0;
	int mCurrentLevel = 0;

	GraphicsSystem * mpGraphicsSystem;
	InputSystem mInputSystem;
	Snake mSnake;
	LevelManager mLevels;
	PowerUp mPowerSettings;
	GraphicsBufferManager mBuffers;
	Sprite mWall;
	Font * mpFont;
	Color mTextColor;
	EventSystem* mpEventSystem;
	HUD mHud;

	time_t mTimer;

	int mDisplayHeight, mDisplayWidth;
	double mTimePassed, mStartTime, mTime;
	double mFrames, mFramesPerSecond;
	const float MILLISECOND_TO_SECOND = 1000;
	const float SPEED_ADJUSTMENT = 100000;
	const string LEVEL_ONE_FILE = "LevelOne.txt";
	const string LEVEL_TWO_FILE = "LevelTwo.txt";
	const string LEVEL_THREE_FILE = "LevelThree.txt";
	const string GAME_SETTINGS = "GameData.txt";
	const Vector2D DEFAULT_LOCATION = Vector2D(0, 0);
	const int DISP_WIDTH = 720;
	const int DISP_HEIGHT = 720;
	const int SPRITES_PER_ROW = 3;
	const int SPRITES_PER_COL = 1;
	const int SPRITE_WIDTH = 60;
	const int SPRITE_HEIGHT = 60;
	const float FRAMES_PER_SECOND = 60;
	const string TITLE = "A SNAKE GAME";
	const string TRANSITION_TITLE = "Are you ready for level";
	const string TRANSITION_TEXT = "Press space to continue";
	const string DEATH_MESSAGE = "You died";
	const string DEATH_INSTRUCTION = "Press space to return to the title screen";
	const string WIN_MESSAGE = "You win";
	const string WIN_INSTRUCTION = "Press space to return to the title screen";
};

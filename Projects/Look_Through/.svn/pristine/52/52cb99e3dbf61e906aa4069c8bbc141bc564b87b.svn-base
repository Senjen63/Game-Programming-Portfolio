#include "Animation.h"


Animation::Animation(AnimationManager& am, std::string framesName, float fps, bool shouldLoop)
{
	mFrames = am.getAnimationFrames(framesName);
	setFramesPerSecond(fps);
	mMillisecondsOnCurrentFrame = 0;
	mLoop = shouldLoop;
}


void Animation::setFramesPerSecond(float fps)
{
	fps = std::max(0.0f, fps);
	mFramesPerSecond = fps;
	mMillisecondsBetweenFrames = 1000.0f / fps; 
}


void Animation::setMillisecondsBetweenFrames(float ms)
{
	ms = std::max(0.0f, ms);
	mMillisecondsBetweenFrames = ms;
	mFramesPerSecond = 1000.0 / ms;
}


void Animation::update(float dt)
{
	mMillisecondsOnCurrentFrame += dt;

	if (mMillisecondsOnCurrentFrame >= mMillisecondsBetweenFrames)
	{
		if (mLoop)
		{
			mCurrentFrameIndex = (mCurrentFrameIndex + 1) % mFrames->size();
		}
		else
		{
			mCurrentFrameIndex = std::min(mCurrentFrameIndex + 1, (int) mFrames->size());
		}

		mMillisecondsOnCurrentFrame = 0;
	}
}

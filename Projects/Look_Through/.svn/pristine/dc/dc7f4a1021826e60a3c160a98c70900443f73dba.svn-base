#include "UnitManager.h"


UnitManager::UnitManager()
{
}


Unit& UnitManager::createUnit(const UnitParameters& params)
{
	Unit* unit = new Unit(params);
	mUnits.push_back(unit);
	return *unit;
}


bool UnitManager::deleteUnit(Unit& unit)
{
	for (int i = 0; i < mUnits.size(); i++)
	{
		Unit* currentUnit = mUnits[i];
		if (&*currentUnit == &unit)
		{
			delete currentUnit;
			mUnits.erase(mUnits.begin() + i);
			return true;
		}
	}

    return false;
}


std::vector<Unit*> UnitManager::getUnitsAtPos(Vector2D point)
{
	std::vector<Unit*> hitUnits;

	for (Unit* unit : mUnits)
	{
		Vector2D origin = unit->getPos();
		Vector2D range = origin + unit->getCurrentAnimation()->getCurrentFrame().getSize();

		if (point.getX() >= origin.getX() && point.getY() >= origin.getY() &&
			point.getX() <= range.getX() && point.getY() <= range.getY())
		{
			hitUnits.push_back(unit);
		}
	}

    return hitUnits;
}


void UnitManager::cleanup()
{
	for (auto it : mUnits)
	{
		delete it;
	}

	mUnits.clear();
}


void UnitManager::update(float dt)
{
	for (Unit* unit : mUnits)
	{
		unit->update(dt);
	}
}


void UnitManager::draw(GraphicsSystem* gSys)
{
	for (Unit* unit : mUnits)
	{
		unit->draw(gSys);
	}
}

#include "Animation.h"

Animation::Animation(int fps, int xSize, int ySize, bool loopCondition, GraphicsBuffer* frame)
{
	for (int i = 0; i < ySize; i++)
	{
		for (int j = 0; j < xSize; j++)
		{
			Sprite animatedSprite = Sprite(frame, Vector2D((frame->getWidth() / xSize) * j,(frame->getHeight() / ySize) * i), Vector2D(frame->getWidth() / ySize, frame->getHeight() / xSize));
			addNewSprite(animatedSprite);
		}
	}

	mSpriteIndex = 0;
	mFps = fps;
	mSpriteTiming = 1000.0 / mFps;
	mRemainingTime = mSpriteTiming;
	mKeepLooping = loopCondition;
}

Animation::~Animation()
{

}

Sprite Animation::getThisSprite()
{
	return mSpriteList[mSpriteIndex];
}

Sprite Animation::updateSprite(float timePassed)
{
	mRemainingTime -= timePassed;
	if (mRemainingTime < 0)
	{
		mSpriteIndex++;
		if (mSpriteIndex >= mSpriteList.size())
		{
			if (mKeepLooping)
			{
				mSpriteIndex = 0;
			}
			else
			{
				mSpriteIndex--;
			}
		}
		mRemainingTime = mSpriteTiming;
	}
	return mSpriteList[mSpriteIndex];
}

void Animation::addNewSprite(Sprite sprite)
{
	mSpriteList.push_back(sprite);
}

void Animation::changeSpriteSpeed(int speed)
{
	mFps = speed;
	mSpriteTiming = 1000.0 / speed;
}
#include "Animation.h"


void Animation::addSprites(GraphicsBuffer* buffer, int width, int height, int size)
{
	int count = 0;
	int numWidth = width;
	int numHeight = height;
	int spriteSize = size;

	Vector2D loc = Vector2D();

	for (int i = 0; i < numHeight; i++)
	{
		for (int j = 0; j < numWidth; j++)
		{
			loc.setX(j * spriteSize);
			loc.setY(i * spriteSize);

			mSpriteList[count] = Sprite(buffer, loc, spriteSize, spriteSize);
			count++;
		}
	}
}

Animation::Animation()
{
	mCurrentSprite = 0;
	mShouldLoop = false;
	mTimeLeft = 0;
	mTimePerFrame = 0;
	mSpriteNum = 0;
	mSpriteList = nullptr;
}

Animation::Animation(GraphicsBuffer* buffer, float mTime, bool mLoop, int spriteNum, int width, int height, int size)
{
	mSpriteList = new Sprite[spriteNum];

	addSprites(buffer, width, height, size);

	mCurrentSprite = 0;
	mShouldLoop = mLoop;

	mTimePerFrame = mTime;
	mTimeLeft = 0;

	mSpriteNum = spriteNum;
}

Animation::Animation(Animation* anim)
{
	mSpriteList = anim->mSpriteList;

	mCurrentSprite = 0;
	mShouldLoop = anim->mShouldLoop;

	mTimePerFrame = anim->mTimePerFrame;
	mTimeLeft = 0;

	mSpriteNum = anim->mSpriteNum;
}

Animation::~Animation()
{
	mShouldLoop = false;
	//delete[] mSpriteList;
}

void Animation::cleanUp()
{
	delete[] mSpriteList;
}

Sprite* Animation::getCurrentSprite()
{
	return &mSpriteList[mCurrentSprite];
}

void Animation::setTimePerFrame(float timeMod)
{
	mTimePerFrame += timeMod;

	if (mTimePerFrame <= 0)
	{
		mTimePerFrame = .0001;
	}
}

void Animation::Update(double dt)
{
	mTimeLeft -= dt;

	if (mTimeLeft <= 0)
	{
		mCurrentSprite++;
		mTimeLeft = mTimePerFrame;

		if (mCurrentSprite >= mSpriteNum && mShouldLoop)
		{
			mCurrentSprite = 0;
		}
	}
}